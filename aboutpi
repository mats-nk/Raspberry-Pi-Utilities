#! /bin/sh
# 2024-02-28	user space
# 2024-06-29    Added header for disk and some start and end space for clarity

# Function to print coloured headings
# Delete "tput" lines for plain output
print_head () {
 tput setaf 6
 echo $1
 tput sgr 0
}

print_head ""

if [ -e /etc/rpi-issue ]; then
 print_head "- Original Installation"
 cat /etc/rpi-issue | grep reference
fi

if [ -e /usr/bin/lsb_release ]; then
 print_head "- Current OS"
#  No LSB modules are available.
 lsb_release -irdc | sed 's/No LSB modules are available.//'
 cat /etc/debian_version
fi
if [ ! -e /usr/share/xsessions ]; then
	print_head "X NOT installed"
fi
BITS=$(getconf LONG_BIT)
print_head "- Kernel"
uname -r
print_head "- Architecture"
uname -m
echo "$BITS bit userland"

print_head "- Model"
cat /proc/device-tree/model && echo

print_head "- hostname"
hostname
print_head "- user"
whoami
print_head "- Network"
hostname -I

# Check status of networking
checkactive () {
if [ $(systemctl is-active $1) = 'active' ]; then
	echo $1 'active'
fi
}
checkactive 'systemd-networkd'
checkactive 'dhcpcd'
checkactive 'NetworkManager'

# Get SSID of connected WiFi (WRONG if AP!)
if [ -e /sys/class/net/wlan0 ]; then
	if [ $(systemctl is-active 'NetworkManager') = 'active' ]; then
		nmcli connection show |  awk '/wlan0/ {print $1}'
	else
		wpa_cli -i wlan0 status | grep -w ssid | awk -F'[=]' '{print $2}'
	fi
fi

print_head "Disk"

CPUID=$(awk '/Serial/ {print $3}' /proc/cpuinfo | cut -c 9-)
echo "Serial: " $CPUID
if [ -e /opt/vc/bin/vcgencmd -o /usr/bin/vcgencmd ]; then
	VERS=$(sudo vcgencmd version  | grep ":")
	print_head "- Firmware"
	echo $VERS
fi
print_head "- Created"
sudo tune2fs -l $(mount -v | awk '/ on \/ / {print $1}') | grep created

print_head ""
